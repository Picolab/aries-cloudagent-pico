ruleset wlb {
  meta {
    shares connections, basicmessages
  }
  global {
    raw_connections = {
  "21uAPcZCEj9oMZTQwaR2YtdjMpCWiJVVb1bZHiNU1owJ": {
    "created": "2022-06-16T15:20:57.978Z",
    "label": "Aries Bifold",
    "my_did": "47LMEFaneDwGybH1BgozAR",
    "their_did": "2s4oAxw5iwoRazJQCDNRH1",
    "their_vk": "21uAPcZCEj9oMZTQwaR2YtdjMpCWiJVVb1bZHiNU1owJ",
    "their_routing": []
  },
  "5n2GycKxLGaDugRsK6qCMft2GgDr6rC1LeJvrftNWBXA": {
    "created": "2021-04-20T17:35:46.645Z",
    "label": "Norberto Martinezâ€™s iPhone",
    "my_did": "2sDuyETXzYUtrvsYZm9c9A",
    "their_did": "9mGQFSkTHQk5KoVLFSsFrM",
    "their_vk": "5n2GycKxLGaDugRsK6qCMft2GgDr6rC1LeJvrftNWBXA",
    "their_endpoint": "https://streetcred-mediator-agent.azurewebsites.net/",
    "their_routing": [
      "CLPfsxUh3L9dvShn64fbFJdLko6GneaBCDZBP66iYUwD"
    ]
  },
  "66UMEG2hakYNRAVrc5tQ6twMQVmmPLz6v4qtCwHiem6o": {
    "label": "SSI+ Desk",
    "my_did": "VvQRhNAqHhSjAqWfczKr8o",
    "their_vk": "66UMEG2hakYNRAVrc5tQ6twMQVmmPLz6v4qtCwHiem6o",
    "their_routing": [],
    "created": "2022-06-16T15:40:45.228Z",
    "their_did": "AM7iWa56Y8oqkX2Gkgb2Jp",
    "their_endpoint": "https://desk-agent.dev.ssi-plus.com"
  },
  "7TBz2T1stoG7JL5hz51HgFqiQxRWgTonEjMVXZpnfb7v": {
    "created": "2022-03-14T16:53:28.780Z",
    "label": "Bruce Conrad at byname.byu.edu",
    "my_did": "LY6tWCGNFR85B2iFdpcEQ9",
    "their_did": "8TmgfobzxK227WH95C3oiu",
    "their_vk": "7TBz2T1stoG7JL5hz51HgFqiQxRWgTonEjMVXZpnfb7v",
    "their_endpoint": "https://byname.byu.edu:8080/sky/event/cl0qy2w8p0189mvpbaejb65sg/none/didcomm/message",
    "their_routing": []
  },
  "96YvmrGeTq5syhBVdsKxRXW2w8F8L4VmgPYynUHgimu5": {
    "created": "2022-06-16T16:05:14.844Z",
    "label": "Lab",
    "my_did": "93B8C8cEwKUSExbtnRkpML",
    "their_did": "FrWPkSjLHU9m7fGRk1nkLq",
    "their_vk": "96YvmrGeTq5syhBVdsKxRXW2w8F8L4VmgPYynUHgimu5",
    "their_endpoint": "https://mediator4.test.indiciotech.io:443",
    "their_routing": [
      "8LVqskLZiHZA1BzZdroWv9STP7prCuPmna6AXGNpiixa",
      "9UZKynvW9bVXBMiLdYb4Mooa6FKRv1Ng8S92cbu79XDT"
    ]
  },
  "A6G9yvuQ85Nb3ihAXTgLQmi2kseGoe1hPXAuqRmGVca6": {
    "created": "2022-06-16T15:03:10.340Z",
    "label": "Government",
    "my_did": "FZHCpT6mfbJdeT8Hvb8SRV",
    "their_did": "HgPiGPR78wQHSRsZ5R51Ru",
    "their_vk": "A6G9yvuQ85Nb3ihAXTgLQmi2kseGoe1hPXAuqRmGVca6",
    "their_endpoint": "https://mediator4.test.indiciotech.io:443",
    "their_routing": [
      "3LUXBT4Rz7f1WfBynX5FEa9VVTZp71szhLxA5J29mUF8",
      "9UZKynvW9bVXBMiLdYb4Mooa6FKRv1Ng8S92cbu79XDT"
    ]
  },
  "B5zqB6KU4KxuiHmBbWZWuJs4pMdWqYgehC49PeNS34hK": {
    "created": "2022-06-16T16:42:16.884Z",
    "label": "RJ",
    "my_did": "4i6EfZYVyaqE7gdrXXx6mr",
    "their_did": "KWKgsYCUg41vzXq19X2mpF",
    "their_vk": "B5zqB6KU4KxuiHmBbWZWuJs4pMdWqYgehC49PeNS34hK",
    "their_endpoint": "https://issuer.staging.liquidavatar.com:3102",
    "their_routing": []
  },
  "EZpyAWu1mRY2vGSRQmEyx4tWXd4QEsaizWMQGycag6sh": {
    "created": "2022-06-16T14:54:23.853Z",
    "label": "Happy Health ID",
    "my_did": "CNgSHFLTSzMjKE3BMyxuN2",
    "their_did": "RtdVzMCUojqH5yqwSSKFjJ",
    "their_vk": "EZpyAWu1mRY2vGSRQmEyx4tWXd4QEsaizWMQGycag6sh",
    "their_routing": []
  },
  "GynPLwnJodvu8mk98kuM55fEb7oufo4CcRweDknhYRrA": {
    "label": "Lynn's MBA Bag",
    "my_did": "JAiipkAjTg1LFQbYtwpyR",
    "their_vk": "GynPLwnJodvu8mk98kuM55fEb7oufo4CcRweDknhYRrA",
    "their_routing": [],
    "created": "2021-04-20T21:56:13.401Z",
    "their_did": "547evRnKbPU5dvck8oWK4T",
    "their_endpoint": "https://manifold.picolabs.io:9090/sky/event/547evRnKbPU5dvck8oWK4T/null/didcomm/message"
  },
  "HiK97UA8PPrZ4cEijoyP9MpPW8bKjsXwJNZ63VhkucUr": {
    "created": "2022-06-16T14:44:08.107Z",
    "label": "Lab",
    "my_did": "GnX2UrpBVZSXeecug34HPp",
    "their_did": "XfSne5avmuNACWTokJ2aza",
    "their_vk": "HiK97UA8PPrZ4cEijoyP9MpPW8bKjsXwJNZ63VhkucUr",
    "their_endpoint": "https://mediator4.test.indiciotech.io:443",
    "their_routing": [
      "P8hGGCy5NKALb4SUnaJcXAE5NXTCM9jhSu8TCH6BN6K",
      "9UZKynvW9bVXBMiLdYb4Mooa6FKRv1Ng8S92cbu79XDT"
    ]
  }
}
    raw_basicmessages = {
  "66UMEG2hakYNRAVrc5tQ6twMQVmmPLz6v4qtCwHiem6o": [
    {
      "@type": "did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/basicmessage/1.0/message",
      "~l10n": {
        "locale": "en"
      },
      "sent_time": "2022-06-16T15:41:46.381Z",
      "content": "hello",
      "from": "outgoing",
      "color": "204,204,204"
    }
  ],
  "7TBz2T1stoG7JL5hz51HgFqiQxRWgTonEjMVXZpnfb7v": [
    {
      "@type": "did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/basicmessage/1.0/message",
      "~l10n": {
        "locale": "en"
      },
      "sent_time": "2022-03-14T20:33:11.371Z",
      "content": "Hello there",
      "from": "outgoing",
      "color": "204,204,204"
    },
    {
      "@type": "https://didcomm.org/basicmessage/1.0/message",
      "~l10n": {
        "locale": "en"
      },
      "sent_time": "2022-03-14T20:34:04.812Z",
      "content": "Bob's your uncle",
      "from": "incoming"
    },
    {
      "@type": "https://didcomm.org/basicmessage/1.0/message",
      "~l10n": {
        "locale": "en"
      },
      "sent_time": "2022-03-14T21:08:44.916Z",
      "content": "cookies",
      "from": "incoming"
    },
    {
      "@type": "https://didcomm.org/basicmessage/1.0/message",
      "~l10n": {
        "locale": "en"
      },
      "sent_time": "2022-03-14T22:13:18.527Z",
      "content": "",
      "from": "incoming"
    },
    {
      "@type": "did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/basicmessage/1.0/message",
      "~l10n": {
        "locale": "en"
      },
      "sent_time": "2022-03-14T22:14:52.538Z",
      "content": "Somehow, I don't know how, you must've sent me a message with no content. At all. How did you do that?",
      "from": "outgoing",
      "color": "204,204,204"
    },
    {
      "@type": "https://didcomm.org/basicmessage/1.0/message",
      "~l10n": {
        "locale": "en"
      },
      "sent_time": "2022-03-14T22:17:44.611Z",
      "content": "Just clicked on Send message button!",
      "from": "incoming"
    },
    {
      "@type": "https://didcomm.org/basicmessage/1.0/message",
      "~l10n": {
        "locale": "en"
      },
      "sent_time": "2022-03-14T22:22:36.076Z",
      "content": "Showing your endpoint as \"https://manifold.picolabs.io:9090/sky/event/LY6tWCGNFR85B2iFdpcEQ9/null/didcomm/message\"",
      "from": "incoming"
    },
    {
      "@type": "did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/basicmessage/1.0/message",
      "~l10n": {
        "locale": "en"
      },
      "sent_time": "2022-03-14T22:30:59.254Z",
      "content": "yes, and no routing",
      "from": "outgoing",
      "color": "204,204,204"
    },
    {
      "@type": "https://didcomm.org/basicmessage/1.0/message",
      "~l10n": {
        "locale": "en"
      },
      "sent_time": "2022-03-15T00:25:34.762Z",
      "content": "Thank you and good-bye",
      "from": "incoming"
    },
    {
      "@type": "https://didcomm.org/basicmessage/1.0/message",
      "~l10n": {
        "locale": "en"
      },
      "sent_time": "2022-03-15T00:27:53.310Z",
      "content": "Trying to get enough basicmessages that the vertical scroll bar will be necessary.",
      "from": "incoming"
    },
    {
      "@type": "https://didcomm.org/basicmessage/1.0/message",
      "~l10n": {
        "locale": "en"
      },
      "sent_time": "2022-03-15T00:30:02.088Z",
      "content": "It is going to take quite a bit more text to trigger the 75% of viewport height which is when we will need a vertical scroll bar.",
      "from": "incoming"
    },
    {
      "@type": "https://didcomm.org/basicmessage/1.0/message",
      "~l10n": {
        "locale": "en"
      },
      "sent_time": "2022-03-15T00:31:07.810Z",
      "content": "I had hard-coded an ECI. And worse, checked it in to a public repository. Deleted it from the pico-engine, so that channel is gone.",
      "from": "incoming"
    },
    {
      "@type": "https://didcomm.org/basicmessage/1.0/message",
      "~l10n": {
        "locale": "en"
      },
      "sent_time": "2022-03-15T14:04:01.707Z",
      "content": "good morning",
      "from": "incoming"
    },
    {
      "@type": "did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/basicmessage/1.0/message",
      "~l10n": {
        "locale": "en"
      },
      "sent_time": "2022-03-15T14:04:17.757Z",
      "content": "good morning",
      "from": "outgoing",
      "color": "204,204,204"
    },
    {
      "@type": "https://didcomm.org/basicmessage/1.0/message",
      "~l10n": {
        "locale": "en"
      },
      "sent_time": "2022-03-15T14:06:35.394Z",
      "content": "and again",
      "from": "incoming"
    },
    {
      "@type": "https://didcomm.org/basicmessage/1.0/message",
      "~l10n": {
        "locale": "en"
      },
      "sent_time": "2022-03-15T14:17:43.463Z",
      "content": "another test message",
      "from": "incoming"
    },
    {
      "@type": "https://didcomm.org/basicmessage/1.0/message",
      "~l10n": {
        "locale": "en"
      },
      "sent_time": "2022-03-15T14:33:12.682Z",
      "content": "yet another test message, this one with a long unbroken string 8C7bhaamXBobqrdmFq6WttyaV2sGzvADhTTztNBybowH",
      "from": "incoming"
    },
    {
      "@type": "did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/basicmessage/1.0/message",
      "~l10n": {
        "locale": "en"
      },
      "sent_time": "2022-03-15T16:26:06.716Z",
      "content": "hey, that's my verification key!",
      "from": "outgoing",
      "color": "204,204,204"
    },
    {
      "@type": "https://didcomm.org/basicmessage/1.0/message",
      "~l10n": {
        "locale": "en"
      },
      "sent_time": "2022-03-15T16:59:30.292Z",
      "content": "MMMMMMMMMMMMM",
      "from": "incoming"
    }
  ],
  "96YvmrGeTq5syhBVdsKxRXW2w8F8L4VmgPYynUHgimu5": [
    {
      "@type": "did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/basicmessage/1.0/message",
      "~l10n": {
        "locale": "en"
      },
      "sent_time": "2022-06-16T16:05:59.471Z",
      "content": "hello Lab",
      "from": "outgoing",
      "color": "204,204,204"
    }
  ],
  "A6G9yvuQ85Nb3ihAXTgLQmi2kseGoe1hPXAuqRmGVca6": [
    {
      "@type": "did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/basicmessage/1.0/message",
      "~l10n": {
        "locale": "en"
      },
      "sent_time": "2022-06-16T15:05:27.764Z",
      "content": "hello",
      "from": "outgoing",
      "color": "204,204,204"
    }
  ],
  "B5zqB6KU4KxuiHmBbWZWuJs4pMdWqYgehC49PeNS34hK": [
    {
      "@type": "did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/basicmessage/1.0/message",
      "@id": "25c149ac-c0ae-4369-b74b-aea312abbf18",
      "~l10n": {
        "locale": "en",
        "localizable": [],
        "catalogs": []
      },
      "content": "test ",
      "sent_time": "2022-06-16T16:42:28.740025Z",
      "from": "incoming"
    },
    {
      "@type": "did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/basicmessage/1.0/message",
      "~l10n": {
        "locale": "en"
      },
      "sent_time": "2022-06-16T16:42:38.458Z",
      "content": "hello RJ",
      "from": "outgoing",
      "color": "204,204,204"
    }
  ],
  "EZpyAWu1mRY2vGSRQmEyx4tWXd4QEsaizWMQGycag6sh": [
    {
      "@type": "https://didcomm.org/basicmessage/1.0/message",
      "@id": "83d55288-dd99-4432-b2e3-f7f56f3e4e35",
      "sent_time": "2022-06-16T14:54:57.700Z",
      "content": "Hello from the interop room 2 session 1",
      "~l10n": {
        "locale": "en"
      },
      "from": "incoming"
    }
  ],
  "FruiHhHB2cPU4UW9w6kQUPcFtLJALPWhj1WkyQ1L4Sre": [
    {
      "@type": "did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/basicmessage/1.0/message",
      "~l10n": {
        "locale": "en"
      },
      "sent_time": "2022-03-11T22:05:26.600Z",
      "content": "hello test",
      "from": "outgoing",
      "color": "204,204,204"
    }
  ],
  "GynPLwnJodvu8mk98kuM55fEb7oufo4CcRweDknhYRrA": [
    {
      "@type": "did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/basicmessage/1.0/message",
      "~l10n": {
        "locale": "en"
      },
      "sent_time": "2021-04-20T21:56:31.139Z",
      "content": "Hey, Lynn. Do you read me?",
      "from": "outgoing",
      "color": "204,204,204"
    },
    {
      "@type": "did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/basicmessage/1.0/message",
      "~l10n": {
        "locale": "en"
      },
      "sent_time": "2021-04-20T21:57:38.231Z",
      "content": "Yep, I see it!",
      "from": "incoming"
    },
    {
      "@type": "did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/basicmessage/1.0/message",
      "~l10n": {
        "locale": "en"
      },
      "sent_time": "2021-05-07T13:12:25.623Z",
      "content": "Can you read me?",
      "from": "incoming"
    },
    {
      "@type": "did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/basicmessage/1.0/message",
      "~l10n": {
        "locale": "en"
      },
      "sent_time": "2021-05-07T13:13:02.026Z",
      "content": "Poking around to see if I can replicate the 404 on notifications error, so far I am unsuccessful :(",
      "from": "incoming"
    }
  ],
  "k4HUz22YPqQcKhz6rdctuTC1bdQMMQmzJjWW2mJiDJ4": [
    {
      "@type": "did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/basicmessage/1.0/message",
      "~l10n": {
        "locale": "en"
      },
      "sent_time": "2021-04-16T13:54:13.595Z",
      "content": "may I send this text?",
      "from": "outgoing",
      "color": "204,204,204"
    }
  ]
}
    basicmessages = function(){
      raw_basicmessages
        .map(function(v,k){
          v.map(function(bm){bm.put("their_vk",k)})
        })
        .values()
        .reduce(function(a,b){a.append(b)},[])
    }
    connections = function(){
      rc_keys = raw_connections.values().head().keys().join(9.chr())
      rc_values = raw_connections
        .values()
        .map(function(c){
          c{"created"} + 9.chr() +
          c{"label"} + 9.chr() +
          c{"my_did"} + 9.chr() +
          c{"their_did"} + 9.chr() +
          c{"their_vk"} + 9.chr() +
          c{"their_endpoint"} + 9.chr() +
          c{"their_routing"}.encode()
        })
      return
        [rc_keys].append(rc_values).join(10.chr())
    }
  }
}
